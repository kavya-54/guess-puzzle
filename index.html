<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Stage 3 ‚Äì Communication & Behavior</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background: #faf5ef;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .chat-window {
      background: white;
      width: 92%;
      max-width: 720px;
      height: 80vh;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .chat-header {
      padding: 16px 20px;
      background: #1f2951;
      color: white;
      font-weight: 500;
      font-size: 20px;
      position: relative;
    }
    .chat-header::after {
      content: "‚úÖ Stage 3";
      position: absolute;
      right: 20px;
      background: #f0b429;
      color: #1f2951;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
    }
    .chat-messages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: #f7f2ed;
    }
    .message {
      margin-bottom: 18px;
    }
    .user {
      font-weight: 500;
      color: #1f2951;
      margin-bottom: 4px;
    }
    .bubble {
      background: #e1e4ea;
      display: inline-block;
      padding: 12px 16px;
      border-radius: 12px;
      max-width: 80%;
      color: #1f2951;
    }
    .you .bubble {
      background: #2aa89b;
      color: white;
      margin-left: auto;
    }
    .chat-input {
      display: flex;
      padding: 15px;
      border-top: 1px solid #ddd;
      background: white;
    }
    .chat-input input {
      flex: 1;
      padding: 10px 15px;
      border: 1px solid #ccc;
      border-radius: 20px;
      font-size: 16px;
    }
    .chat-input button {
      margin-left: 10px;
      padding: 10px 18px;
      background: #1f2951;
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
    }
    .chat-input button:hover {
      background: #182040;
    }
    .success { color: #2e7d32; font-weight: 500; }
    .error   { color: #c62828; font-weight: 500; }
  </style>
</head>
<body>

<div class="chat-window">
  <div class="chat-header">üí¨ Stage 3: Decode the Goss in Threads</div>
  <div class="chat-messages" id="chatLog"></div>
  <div class="chat-input">
    <input type="text" id="userInput" placeholder="Type your reply..." />
    <button onclick="submitAnswer()">Send</button>
  </div>
</div>

<script>
  const fullPuzzleSet = [
    { prompt: ["@HRGuru: 'Let's circle back' usually means what?", "@ManagerMike: I'll follow up later, but you know what that means..."], answer: "never happening", success: "‚úÖ Correct ‚Äì that's corporate speak for 'don't wait up.'" },
    { prompt: ["@InternIsha: 'Ping me if anything.' What‚Äôs the real meaning?", "Hint: It's not available immediately."], answer: "i'll ignore", success: "üéØ Yep ‚Äì you're not hearing back anytime soon!" },
    { prompt: ["@TeamLead: 'ASAP' means round the clock effort. What's it really?", "Clock emoji hint ‚è∞"], answer: "as soon as possible", success: "‚úÖ Yes! But in reality, it's kind of urgent." },
    { prompt: ["@Boss: 'Per my last email...' That tone is...?", "Pick the vibe."], answer: "passive aggressive", success: "üëè Exactly ‚Äì classic passive-aggressive opener." },
    { prompt: ["@Coworker: 'I'm looped in.' Means what exactly?", "Empty loop, maybe?"], answer: "i was cc'd", success: "‚úîÔ∏è Correct ‚Äì means you'd just been cc‚Äôd for show." },
    { prompt: ["@Manager: 'Let's take offline.' That means what?", "This one is not about electricity."], answer: "in private later", success: "üëç Right ‚Äì we'll discuss away from the group." },
    { prompt: ["@Peer: 'I'll keep you posted.' Should you expect updates?", "Emoji eyes üëÄ"], answer: "not really", success: "üéØ Yup ‚Äì updates might never arrive." },
    { prompt: ["@HR: 'We're all on the same page.' Means what?", "Metaphor alert!"], answer: "we agree", success: "‚úÖ Correct ‚Äì kind of means 'so you better agree'." },
    { prompt: ["@Colleague: 'Low-hanging fruit.' What are they talking about?", "Fruit joke."], answer: "easy tasks", success: "üçá Yes ‚Äì the tasks anyone can do." },
    { prompt: ["@Manager: 'Let's circle around the agenda.' Is that odd?","Hint: It's repetitive."], answer: "we're stalling", success: "‚úÖ Exactly ‚Äì avoiding decisions again." },
    { prompt: ["@LeadDev: 'Can you raise a ticket?' What does this mean?"], answer: "do it yourself", success: "‚úÖ Accurate ‚Äì they just passed the work to you!" },
    { prompt: ["@ProjectMgr: 'Let's align on this.' What's the actual plan?"], answer: "argue it out", success: "‚úÖ Haha yes! It means let's debate." },
    { prompt: ["@SlackBot: 'Daily standup at 9am sharp!' What's implied?"], answer: "join at 9:10", success: "‚úÖ Right ‚Äì nobody's actually sharp." },
    { prompt: ["@Support: 'We'll escalate this.' Now what?"], answer: "nothing happens", success: "‚úÖ Correct! Escalation = Email ping-pong." },
    { prompt: ["@TeamEmail: 'Gentle Reminder' ‚Äî how gentle is it?"], answer: "very aggressive", success: "‚úÖ Yes ‚Äì passive-aggression level: pro." }
  ];

  // Shuffle and pick 5
  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  const puzzles = shuffle(fullPuzzleSet).slice(0, 5);
  let index = 0;
  const chatLog = document.getElementById("chatLog");

  function showPrompt() {
    puzzles[index].prompt.forEach(line => {
      const msg = document.createElement("div");
      msg.classList.add("message");
      msg.innerHTML = `<div class="user">${line.split(":")[0]}</div><div class="bubble">${line.split(":")[1]?.trim() || line}</div>`;
      chatLog.appendChild(msg);
    });
    chatLog.scrollTop = chatLog.scrollHeight;
  }

  function submitAnswer() {
    const input = document.getElementById("userInput");
    const text = input.value.trim().toLowerCase();
    if (!text) return;

    const userMsg = document.createElement("div");
    userMsg.classList.add("message", "you");
    userMsg.innerHTML = `<div class="user">You</div><div class="bubble">${input.value}</div>`;
    chatLog.appendChild(userMsg);

    const correct = puzzles[index].answer.toLowerCase();
    const reply = document.createElement("div");
    reply.classList.add("message");
    const resp = document.createElement("div");
    resp.classList.add("bubble");

    if (text === correct) {
      resp.innerHTML = puzzles[index].success;
      resp.classList.add("success");
      reply.appendChild(resp);
      chatLog.appendChild(reply);
      index++;
      if (index < puzzles.length) {
        setTimeout(showPrompt, 1000);
      } else {
        setTimeout(() => {window.location.href = "puzzle4.html; // ‚úÖ Redirect to Stage 4"}, 1200);
      }
    } else {
      resp.innerHTML = "‚ùå Not quite. Try something more office-sarcastic.";
      resp.classList.add("error");
      reply.appendChild(resp);
      chatLog.appendChild(reply);
    }

    input.value = "";
    chatLog.scrollTop = chatLog.scrollHeight;
  }

  window.onload = showPrompt;
</script>

</body>
</html>
